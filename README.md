# Интернет-магазин - Дипломный проект Netology

## Описание проекта

Django REST API для интернет-магазина с функциональностью заказов, каталога товаров, корзины покупок и управления партнерами.

## Технологии

- **Backend:** Django 4.2.7, Django REST Framework 3.14.0
- **База данных:** SQLite (для разработки)
- **Асинхронные задачи:** Celery 5.3.4
- **Email:** Django Email Backend
- **Валидация:** Кастомные валидаторы
- **Тестирование:** Django Test Framework

## Установка и запуск

### 1. Клонирование репозитория
```bash
git clone https://github.com/IvanovSemjon/Netology_final_project.git
cd Netology_final_project/reference/netology_pd_diplom
```

### 2. Создание виртуального окружения
```bash
python -m venv venv
venv\Scripts\activate  # в моей Hаботе windows
```

### 3. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 4. Настройка базы данных
```bash
python manage.py makemigrations
python manage.py migrate
```

### 5. Создание суперпользователя
```bash
python manage.py createsuperuser
```

### 6. Загрузка тестовых данных
```bash
python manage.py load_shop_data --all
```

### 7. Запуск сервера
```bash
python manage.py runserver
```

Приложение будет доступно по адресу: `http://127.0.0.1:8000/`

## Структура API

### Базовые URL:
- **API:** `http://127.0.0.1:8000/api/v1/`
- **Админка:** `http://127.0.0.1:8000/admin/`

### Корневой эндпоинт API:
- **URL:** `GET /api/v1/`
- **Описание:** Возвращает информацию о доступных эндпоинтах API
- **Ответ:** JSON с описанием основных эндпоинтов

## Пошаговая инструкция для тестирования

### Шаг 0: Проверка API

1. **Получить информацию об API:**
   - URL: `GET /api/v1/`
   - Ожидаемый результат: JSON с описанием доступных эндпоинтов

### Шаг 1: Проверка каталога товаров

1. **Получить список категорий:**
   - URL: `GET /api/v1/categories/`
   - Ожидаемый результат: Список всех категорий товаров

2. **Получить список магазинов:**
   - URL: `GET /api/v1/shops/`
   - Ожидаемый результат: Список активных магазинов

3. **Получить список товаров:**
   - URL: `GET /api/v1/products/`
   - Ожидаемый результат: Список всех товаров с ценами и параметрами

### Шаг 2: Регистрация и аутентификация

1. **Регистрация нового пользователя:**
   - URL: `POST /api/v1/user/register/`
   - Данные для ввода: `{"first_name": "Иван", "last_name": "Иванов", "email": "test@example.com", "password": "TestPass123", "company": "Тест Компания", "position": "Тестировщик"}`
   - Ожидаемый результат: Создание пользователя и отправка email для подтверждения

2. **Подтверждение email:**
   - URL: `POST /api/v1/user/register/confirm/`
   - Данные для ввода: `{"email": "test@example.com", "token": "токен_из_консоли"}`
   - Ожидаемый результат: Активация аккаунта пользователя

3. **Вход в систему:**
   - URL: `POST /api/v1/user/login/`
   - Данные для ввода: `{"email": "test@example.com", "password": "TestPass123"}`
   - Ожидаемый результат: Получение токена авторизации

### Шаг 3: Работа с корзиной и заказами

1. **Добавление товаров в корзину:**
   - URL: `POST /api/v1/basket/`
   - Данные для ввода: `{"items": "[{\"product_info\": 1, \"quantity\": 2}]"}`
   - Требует авторизации

2. **Просмотр корзины:**
   - URL: `GET /api/v1/basket/`
   - Требует авторизации

3. **Обновление количества в корзине:**
   - URL: `PUT /api/v1/basket/`
   - Данные для ввода: `{"items": "[{\"id\": 1, \"quantity\": 5}]"}`
   - Требует авторизации

4. **Удаление товаров из корзины:**
   - URL: `DELETE /api/v1/basket/`
   - Данные для ввода: `{"items": "1,2,3"}`
   - Требует авторизации

5. **Создание контакта для доставки:**
   - URL: `POST /api/v1/user/contact/`
   - Данные для ввода: `{"city": "Москва", "street": "Тверская", "house": "1", "apartment": "10", "phone": "+79001234567"}`
   - Требует авторизации

6. **Просмотр адресов доставки:**
   - URL: `GET /api/v1/user/contact/`
   - Требует авторизации

7. **Подтверждение заказа:**
   - URL: `POST /api/v1/order/`
   - Данные для ввода: `{"id": "1", "contact": "1"}`
   - Требует авторизации

### Шаг 4: Создание пользователя-магазина

**Для работы с партнерскими функциями необходимо создать пользователя с типом 'shop' через админку:**

1. **Войдите в админку:** `http://127.0.0.1:8000/admin/`
2. **Создайте пользователя:**
   - Перейдите в **"BACKEND" → "Пользователи" → "Добавить пользователя"**
   - Email: `shop@example.com`
   - Password: `ShopPass123`
   - Type: выберите **"Магазин"** (shop)
   - Active: поставьте галочку ✓
3. **Создайте магазин:**
   - Перейдите в **"BACKEND" → "Магазины" → "Добавить магазин"**
   - Name: `Тестовый магазин`
   - User: выберите созданного пользователя
   - Accepting orders: поставьте галочку ✓

### Шаг 5: Управление партнерами

1. **Обновление прайс-листа:**
   - URL: `POST /api/v1/partner/update/`
   - **Вариант 1 - по URL:** `{"url": "https://raw.githubusercontent.com/netology-code/pd-diplom/master/data/shop1_new.yaml"}`
   - **Вариант 2 - загрузка файла:** `multipart/form-data` с полем `file`
   - Требует авторизации как магазин
   - Ожидаемый результат: Обновление каталога товаров магазина

2. **Получение статуса магазина:**
   - URL: `GET /api/v1/partner/state/`
   - Требует авторизации как магазин
   - Ожидаемый результат: Информация о статусе приема заказов

3. **Изменение статуса магазина:**
   - URL: `POST /api/v1/partner/state/`
   - Данные для ввода: `{"state": "true"}` или `{"state": "false"}`
   - Требует авторизации как магазин
   - Ожидаемый результат: Изменение статуса приема заказов

4. **Получение заказов магазина:**
   - URL: `GET /api/v1/partner/orders/`
   - Требует авторизации как магазин
   - Ожидаемый результат: Список заказов для данного магазина

## Postman коллекция

### 1. Настройка переменных окружения

Создайте в Postman переменные:
- `base_url`: `http://127.0.0.1:8000`
- `token`: (будет заполнено после авторизации)

### 2. Запросы для тестирования

#### 2.1 Общая информация об API

**Получить информацию об API**
```
GET {{base_url}}/api/v1/
```

#### 2.2 Каталог товаров

**Получить категории**
```
GET {{base_url}}/api/v1/categories/
```

**Получить магазины**
```
GET {{base_url}}/api/v1/shops/
```

**Получить товары**
```
GET {{base_url}}/api/v1/products/
```

**Получить товары по категории**
```
GET {{base_url}}/api/v1/products/?category_id=224
```

**Получить товары по магазину**
```
GET {{base_url}}/api/v1/products/?shop_id=1
```

## Структура проекта

```
backend/
├── api/
│   ├── serializers/     # Сериализаторы по модулям
│   ├── views/           # API views по функциональности
│   ├── permissions.py   # Кастомные разрешения
│   └── urls.py         # API маршруты
├── models/             # Модели данных
├── services/           # Бизнес-логика
├── tasks/              # Celery задачи
├── tests/              # Тесты
├── management/         # Django команды
└── admin.py           # Настройки админки
```

## Контакты

Автор: Иванов Семён
Телефон: +7-999-968-2498
Email: ivanovsemjon@yandex.ru
GitHub: https://github.com/IvanovSemjon/Netology_final_project